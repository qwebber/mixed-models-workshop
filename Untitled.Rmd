---
title: "mixed-models-workshop"
output: html_document
date: '2023-03-10'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

## What are mixed models and why should we use them?

**Mixed effects models ** are an extension of linear models that include a combination of fixed and random effects (Bolker et al. 2009; Harrison et al. 2018). 

Mixed effects models and the introduction of random effects have a number of key (non-mutually exclusive) benefits (adapted from Harrison et al. 2018): 

  1.  **Complex datasets with built in non-independence:** Biological datasets are often highly structured, containing clusters of **non-independent observational units** that are hierarchical in nature, and mixed models allow us to explicitly model the non-independence in such data. 
  2.  **Improved inference:** Explicit modelling of the random effects structure will improve  inference about fixed effects, depending on which level of the systemâ€™s hierarchy is being manipulated. 
  3.  **Grouping variables:** Random effects typically represent some **grouping variable** and allow the estimation of variance in the response variable within and among these groups, which reduces the probability of false positives (Type I error rates) and false negatives (Type II error rates).



## Mixed model resources: 

For more details, code, and more information on using mixed effects models see the following online resources: 

  1. [Our coding club](https://ourcodingclub.github.io/tutorials/mixed-models/>)

And the following published articles and books: 

  1. [Harrison et al. 2018 A brief introduction to mixed effects modelling and multi-model inference in ecology](<https://peerj.com/articles/4794/)
  2. [Bolker et al. 2009 Generalized linear mixed models: a practical guide for ecology and evolution](https://www.sciencedirect.com/science/article/pii/S0169534709000196?via%3Dihub)
  3. [Zuur et al. 2009 Mixed Effects Models and Extensions in Ecology with R](https://link.springer.com/book/10.1007/978-0-387-87458-6)


## load key libraries
```{r , message = FALSE, results = 'asis', warning = FALSE}
library(lme4)
library(nlme)
library(ggplot2)
library(tidyverse)
```

## When should we use mixed models: 

Mixed models are most appropriate when: 

  1. Data have inherent **non-independence** through nested variables
  2. One or more variable are **grouped** and (as the user) we want to account for variance within and among groups, but not we are not interested in the statistical effect of that grouped variable on our response variable. 

## Example data

We will use the [dragon](http://gkhajduk.d.pr/9GPn/3nbbPoK6) data, which includes data on body length and test score for dragons from 8 mountain ranges. Within each mountain range there are three sites (a, b, and c).

We will follow prior examples using these data from [Elise Gallois](https://ourcodingclub.github.io/tutorials/mixed-models/).

## Explore the data
```{r, message = FALSE, warning = FALSE}

## load dragon data 
load("dragons.RData")

## convert to tibble and check out the columns
dragons <- as_tibble(dragons)

## remove X column and 
dragons <-   
    dragons %>% 
    select(-X) 

## view head of dataset 
head(dragons)

## check relationships between all pairwise combinations of variables
dragons %>% GGally::ggpairs()

```

## Getting started with syntax:

Mixed model syntax using the `lmer`, `nlme`, and `glmmTMB` packages are similar. 

Using the same syntax as a linear model

## Examples of mixed models





```{r, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
